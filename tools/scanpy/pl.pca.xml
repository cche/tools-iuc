<tool id="pl.pca" name="pl.pca" version="1.3.1+galaxy1">
    <description>Scatter plot in PCA coordinates</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <command detect_errors="exit_code"><![CDATA[
          python $script_file
      ]]></command>
    <configfiles>
        <configfile name="script_file"><![CDATA[
@CMD_imports@
@CMD_read_inputs@
sc.settings.figdir = '.'
@CMD_params_pl_color@
@CMD_params_pl_groups@

components=[]
#for $i, $s in enumerate($plot.components)
components.append('$s.axis1,$s.axis2')
#end for
if len(components) == 0:
  components=None

sc.pl.pca(
    adata=adata,
    color=col,
    use_raw=$use_raw,
    sort_order=$sort_order,
    groups=groups,
    components=components,
    projection='$plot.projection',
    legend_loc='$plot.legend_loc',
    legend_fontsize=$plot.legend_fontsize,
    legend_fontweight='$plot.legend_fontweight',
    palette='$plot.palette',
    frameon=$plot.frameon,
    size=$plot.size,
#if $plot.title
    title='$plot.title',
#end if
    ncols=$plot.ncols,
    wspace=$plot.wspace,
    hspace=$plot.hspace,
    @CMD_params_matplotlib_pyplot_scatter@
    show=False,
    save='.$format')
]]></configfile>
    </configfiles>
    <inputs>
        <expand macro="inputs_anndata"/>
        <expand macro="pl_color"/>
        <expand macro="param_use_raw"/>
        <param argument="sort_order" type="boolean" truevalue="True" falsevalue="False" checked="true" label="Sort order?" help="For continuous annotations used as color parameter, plot data points with higher values on top of others."/>
        <expand macro="pl_groups"/>
        <section name="plot" title="Plot attributes">
            <expand macro="pl_components"/>
            <expand macro="pl_projection"/>
            <expand macro="pl_legend_loc"/>
            <expand macro="pl_legend_fontsize"/>
            <expand macro="pl_legend_fontweight"/>
            <expand macro="pl_palette"/>
            <expand macro="pl_frameon"/>
            <expand macro="pl_size"/>
            <expand macro="pl_title"/>
            <param argument="ncols" type="integer" value="4" label="Number of panels per row" help=""/>
            <param argument="wspace" type="float" value="0.1" label="Width of the space between multiple panels" help=""/>
            <param argument="hspace" type="float" value="0.25" label="Geight of the space between multiple panels" help=""/>
        </section>
        <expand macro="param_plot_format"/>
        <expand macro="params_matplotlib_pyplot_scatter"/>
    </inputs>
    <outputs>
        <expand macro="plot_output"/>
    </outputs>
    <tests>
        <test>
            <conditional name="input">
                <param name="format" value="h5ad" />
                <param name="adata" value="pbmc68k_reduced.h5ad" />
            </conditional>
            <repeat name="color">
                <param name="color" value="bulk_labels"/>
            </repeat>
            <param name="use_raw" value="False"/>
            <param name="sort_order" value="True"/>
            <repeat name="groups">
                <param name="group" value=""/>
            </repeat>
            <section name="plot">
                <repeat name="components">
                    <param name="axis1" value="1"/>
                    <param name="axis2" value="2"/>
                </repeat>
                <param name="projection" value="2d"/>
                <param name="legend_loc" value="right margin"/>
                <param name="legend_fontsize" value="1"/>
                <param name="legend_fontweight" value="normal"/>
                <param name="palette" value="bwr"/>
                <param name="frameon" value="False"/>
                <param name="size" value="1"/>
                <param name="title" value="A title"/>
                <param name="ncols" value="4"/>
                <param name="wspace" value="0.1"/>
                <param name="hspace" value="0.25"/>
            </section>
            <param name="format" value="png"/>
            <section name="matplotlib_pyplot_scatter">
                <param name="alpha" value="0.75"/>
                <param name="linewidths" value="0"/>
                <param name="edgecolors" value="face"/>
            </section>
            <output name="out_png" file="pl.pca.pbmc68k_reduced.bulk_labels_2d.png"/>
        </test>
        <test>
            <conditional name="input">
                <param name="format" value="h5ad" />
                <param name="adata" value="pbmc68k_reduced.h5ad" />
            </conditional>
            <repeat name="color">
                <param name="color" value="bulk_labels"/>
            </repeat>
            <param name="use_raw" value="False"/>
            <param name="sort_order" value="True"/>
            <repeat name="groups">
                <param name="group" value=""/>
            </repeat>
            <section name="plot">
                <param name="projection" value="3d"/>
                <param name="legend_loc" value="right margin"/>
                <param name="legend_fontsize" value="1"/>
                <param name="legend_fontweight" value="normal"/>
                <param name="palette" value="bwr"/>
                <param name="frameon" value="False"/>
                <param name="size" value="1"/>
                <param name="title" value="A title"/>
                <param name="ncols" value="4"/>
                <param name="wspace" value="0.1"/>
                <param name="hspace" value="0.25"/>
            </section>
            <param name="format" value="png"/>
            <section name="matplotlib_pyplot_scatter">
                <param name="alpha" value="0.75"/>
                <param name="linewidths" value="0"/>
                <param name="edgecolors" value="face"/>
            </section>
            <output name="out_png" file="pl.pca.pbmc68k_reduced.bulk_labels_3d.png"/>
        </test>
        <test>
            <conditional name="input">
                <param name="format" value="h5ad" />
                <param name="adata" value="pbmc68k_reduced.h5ad" />
            </conditional>
            <repeat name="color">
                <param name="color" value="CD3D"/>
            </repeat>
            <repeat name="color">
                <param name="color" value="CD79A"/>
            </repeat>
            <param name="use_raw" value="False"/>
            <param name="sort_order" value="True"/>
            <repeat name="groups">
                <param name="group" value=""/>
            </repeat>
            <section name="plot">
                <repeat name="components">
                    <param name="axis1" value="1"/>
                    <param name="axis2" value="2"/>
                </repeat>
                <param name="projection" value="3d"/>
                <param name="legend_loc" value="right margin"/>
                <param name="legend_fontsize" value="1"/>
                <param name="legend_fontweight" value="normal"/>
                <param name="palette" value="bwr"/>
                <param name="frameon" value="False"/>
                <param name="size" value="1"/>
                <param name="title" value="A title"/>
                <param name="ncols" value="4"/>
                <param name="wspace" value="0.1"/>
                <param name="hspace" value="0.25"/>
            </section>
            <param name="format" value="png"/>
            <section name="matplotlib_pyplot_scatter">
                <param name="vmax" value="5"/>
                <param name="vmin" value="-5"/>
                <param name="alpha" value="0.75"/>
                <param name="linewidths" value="0"/>
                <param name="edgecolors" value="face"/>
            </section>
            <output name="out_png" file="pl.pca.pbmc68k_reduced.bulk_labels_3d.png"/>
        </test>
    </tests>
    <help><![CDATA[
Scatter plot in PCA coordinates.

More details on the `scanpy documentation
<https://scanpy.readthedocs.io/en/latest/api/scanpy.api.pl.pca.html#scanpy.api.pl.pca>`__
    ]]></help>
  <expand macro="citations"/>
</tool>
